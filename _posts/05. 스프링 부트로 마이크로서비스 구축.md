# 스프링 부트는 무엇인가?
- 스프링 부트는 애플리케이션 서버도, 웹 서버도 아니다. 다양한 애플리케이션 및 웹서버와의 통합을 제공한다.
- 스프링 부트는 특정 프레임워크나 스펙을 구현하지 않는다.

## 마이크로서비스로 빠르게 프로토타입 구축
애플리케이션을 설정하는 단계는 다음과 같다.
1. 사용할 스프링 MVC, JPA, 하이버네이트의 버전을 결정하라
2. 모든 다른 레이어를 연결하는 스프링 콘텍스트를 설정하라.
3. 스프링 MVC(스프링 MVC 구성 포함)로 웹 레이어를 설정하라 (DispatcherServlet, 핸들러, 리졸버, 뷰 리졸버 등에 대한 빈 구성)
4. 데이터 레이어에서 하이버네이트를 설정하라 (SessionFactory, 데이터 소스 등에 대한 빈 구성)
5. 서로 다른 환경에 따라 애플리케이션 구성을 저장하는 방법을 결정하고 구현하라.
6. 단위 테스트를 어떻게 할 것인지 결정하라
7. 트랜잭션 전략을 결정하고 구현하라
8. 보안을 구현하는 방법을 결정하고 구현하라
9. 로깅 프레임워크를 설정하라
10. 프로덕션 환경에서 애플리케이션을 모니터링할 방법을 결정하고 구현하라.
11. 애플리케이션에 대한 통계를 제공하기 위해 메트릭스 관리 시스템을 결정하고 구현하라.
12. 애플리케이션을 웹 또는 애플리케이션 서버에 배포하는 방법을 결정하고 구현하라.

위의 단계 중 최소한 몇 가지를 완료해야 비즈니스 로직을 구축할 수 있다. 마이크로서비스는 빠른 시작을 원한다. 앞의 12단계를 모두 거치면 마이크로서비스를 쉽게 개발할 수 없다. 이것이 스프링 부트가 해결하고자 하는 문제다.

> 스프링부트를 사용하면 '바로 실행'할 수 있는 스탠드얼론, 프로덕션급 스프링 기반 애플리케이션을 쉽게 만들 수 있다. 우리는 스프링 플랫폼 및 서드파티 라이브러리에 대해 의견을 개진해 최소한의 관심으로 시작할 수 있다. 대부분의 스프링 부트 애플리케이션은 스프링 구성이 거의 필요하지 않다.

스프링부트는 개발자가 마이크로서비스 뒤에 있는 비즈니스 로직에 집중할 수 있게 해준다.

## 기본 목표
- 스프링-기반 프로젝트를 신속하게 구축
- 일반적인 사용법에 따라 기본적인 가정을 만든다. 기본값과의 차이를 처리하는 구성 옵션을 제공한다.
- 다양한 비기능적인 특징을 제공한다.
- 코드 생성을 사용하지 말고, 많은 XML 구성을 피하라

## 비기능적인 특징
- 다양한 프레임워크, 서버 및 스펙의 버전 관리 및 설정에 대한 기본 처리
- 애플리케이션 보안을 위한 기본 옵션
- 확장 가능성이 있는 기본 애플리케이션 매트릭스
- 상태 확인을 사용한 기본 애플리케이션 모니터링
- 외부화된 설정을 위한 여러 옵션

# 스프링 부트 Hello World
메이븐 사용하여 의존성 관리한다. 스프링부트 애플리케이션으로 시작하는 과정은 다음과 같다.
1. pom.xml 파일에서 spring-boot-starter-parent를 설정하라
2. 필요한 스타터 프로젝트로 pom.xml 파일을 구성하라
3. 애플리케이션을 실행하려면 spring-boot-maven-plugin을 설정하라
4. 첫 번째 스프링 부트 실행 클래스를 만들어라.

## spring-boot-starter-parent 구성
spring-boot-starter-parent를 가진 간단한 pom.xml 구성하자.
```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
     http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.mastering.spring</groupId>
	<artifactId>springboot-example-ch5</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>First Spring Boot Example</name>
	<packaging>war</packaging>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.0.0.M1</version>
	</parent>
	<properties>
		<java.version>1.8</java.version>
	</properties>
	<repositories>
		<repository>
			<id>spring-milestones</id>
			<name>Spring Milestones</name>
			<url>https://repo.spring.io/milestone</url>
			<snapshots>
				<enabled>false</enabled>
			</snapshots>
		</repository>
	</repositories>
    <pluginRepositories>
		<pluginRepository>
			<id>spring-milestones</id>
			<name>Spring Milestones</name>
			<url>https://repo.spring.io/milestone</url>
			<snapshots>
				<enabled>false</enabled>
			</snapshots>
		</pluginRepository>
	</pluginRepositories>
</project>
```
왜 우리는 spring-boot-starter-parent가 필요할까?
spring-boot-starter-parent 의존성은 사용할 자바 기본버전, 스프링 부트가 사용하는 의존성의 기본 버전 및 메이븐 플러그인의 기본 설정을 포함한다.
> spring-boot-starter-parent 의존성은 스프링 부트-기반 애플리케이션에 대한 의존성 및 플러그인 관리를 제공하는 부모 POM이다.

## spring-boot-starter-parent
spring-boot-starter-parent 의존성은 POM의 상단에 정의된 spring-boot-dependencies를 상속받는다. 다음 코드 단락은 spring-boot-starter-parent에서 추출한 내용이다.
```xml
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-dependencies</artifactId>
		<version>2.0.0.M1</version>
        <relativePath>../../spring-boot-dependencies</relativePath>
	</parent>
```
spring-boot-dependencies는 스프링 부트가 사용하는 모든 의존성에 대한 기본 의존성 관리를 제공한다. 다음은 spring-boot-dependencies에서 설정되는 다양한 의존성의 서로 다른 버전을 보여준다.
```xml
<activemq.version>5.15.3</activemq.version>
<antlr2.version>2.7.7</antlr2.version>
<appengine-sdk.version>1.9.62</appengine-sdk.version>
<artemis.version>2.4.0</artemis.version>
<aspectj.version>1.8.13</aspectj.version>
<assertj.version>3.9.1</assertj.version>
<atomikos.version>4.0.6</atomikos.version>
<bitronix.version>2.1.4</bitronix.version>
...생략
```
의존성의 특정 버전을 덮어 쓰려면 애플리케이션의 pom.xml 파일에 적절한 이름을 가진 등록 정보를 제공해야 한다.
```xml
<properties>
    <mockito.version>1.10.20</mockito.version>
</properties>
```

스프링의 특정 버전과 호환되는 최신 스프링 세션 버전은 어떻게 찾을까? 일반적인 대답은 문서를 읽는 것이다. 그러나 스프링 부트를 사용하면 spring-boot-starter-parent로 쉽게 만들 수 있다. 새로운 스프링 버전으로 업그레이드하고 싶다면 스프링 버전에 대한 spring-boot-starter-parent 의존성을 찾아야 한다. spring-boot-starter-parent의 해당 특정 버전을 사용하기 위해 애플리케이션을 업그레이드하면 다른 모든 의존성이 새 스프링 버전과 호환되는 버전으로 업그레이드된다.

## 필요한 스타터 프로젝트를 사용해 pom.xml 구성

### 스타터 프로젝트 이해
스타터는 여러가지 목적으로 커스텀이 단순화된 의존성 디스크립터다. 예를 들어, spring-boot-starter-web은 스프링 MVC를 사용해 RESTful이 포함된 웹 애플리케이션을 작성하기 위한 스타터다. 기본 임베디드 컨테이너로 톰캣을 사용한다.
spring-boot-starter-web을 의존성에 포함시키면 다음과 같이 자동으로 사전 구성된다.

- 스프링MVC
- 호환 가능한 버전의 jackson-databind(바인드용) 및 hibernate-validator(폼 벨리데이션용)
- spring-boot-starter-tomcat(톰캣을 위한 스타터 프로젝트)

spring-boot-starter-web을 사용하면 많은 프레임워크가 자동으로 설정된다. 우리는 만들고자 하는 웹 앱을 위해 단위 테스트되고, 톰캣에 배포되길 원한다. 다음 단락은 우리가 필요로하는 다양한 스타터 의존성을 보여준다. 다음 파일을 pom.xml에 추가해야 한다.

```xml
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-tomcat</artifactId>
			<scope>provided</scope>
		</dependency>
	</dependencies>
```
세 가지 스타터 프로젝트를 추가한다.
- 이미 spring-boot-starter-web에 대해 논의했다. 스프링 MVC로 웹 애플리케이션을 구현하는 데 필요한 프레임워크를 제공한다.
- spring-boot-starter-test 의존성은 단위 테스트에 필요한, 다음과 같은 테스트 프레임워크를 제공한다.
  -- JUnit : 기본 단위 테스트 프레임워크
  -- Mockito : 모킹을 위해
  -- Hamcrest, AssertJ : 검증(assert)를 위해
  -- 스프링 테스트 : 스프링 콘텍스트-기반 애플리케이션을 위한 단위 테스트 프레임워크
- spring-boot-starter-tomcat 의존성은 웹 애플리케이션을 실행하는데 있어 기본값이다. 설정을 명확하게 하기 위해 포함시킨다. spring-boot-starter-tomcat은 톰캣을 임베디드 서블릿 컨테이너로 사용하기 위한 스타터다.

이제 pom.xml을 스타터 페어런트와 필요한 스타터 프로젝트로 구성했다. spring-boot-maven-plugin을 추가하면 스프링 부트 애플리케이션을 실행할 수 있다.

## spring-boot-maven-plugin 구성
스프링 부트를 사용해 애플리케이션을 구축할 때는 다음과 같은 두 가지 상황이 발생할 수 있다.
- jar 또는 war를 빌드하지 않고 애플리케이션을 실행하고 싶다.
- 나중에 배포할 수 있도록 jar 및 war을 빌드하고자 한다.

spring-boot-maven-plugin의존성은 앞의 두 가지 상황 모두에 대한 기능을 제공한다. 다음 단락은 애플리케이션에서 spring-boot-maven-plugin을 설정하는 방법을 보여준다.
```xml
	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
		</plugins>
	</build>
```
spring-boot-maven-plugin의존성은 스프링 부트 애플리케이션을 위한 몇가지 goal을 제공한다. 가장 인기 있는 goal은 run이다(프로젝트의 루트 폴더에서 명령 프롬프트상에 mvn spring-boot:run을 통해 실행할 수 있다).

## 첫 스프링 부트 구동 클래스 생성
다음 클래스는 간단한 스프링 부트 구동 클래스를 생성하는 방법을 설명한다. 다음 코드 단락에서처럼 SpringApplication 클래스의 정적 구동 메서드를 사용한다.
```java
package com.mastering.spring.springboot;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ApplicationContext;

@SpringBootApplication
public class Application {
	public static void main(String[] args) {
		ApplicationContext ctx = SpringApplication.run(Application.class, args);
	}
}
```
앞의 코드는 SpringApplication클래스에서 정적 구동 메서드를 실행하는 간단한 자바 메인 메서드다.

### SpringApplication 클래스
SpringApplication 클래스는 자바 메인 메서드에서 스프링 애플리케이션을 구동하고 부트스트랩을 사용할 수 있다. 다음은 스프링 부트 애플리케이션이 부트스트랩될 때 일반적으로 수행되는 단계다.
1. 스프링의 ApplicationContext 인스턴스를 생성한다.
2. 명령줄 인수를 받아들이고, 이를 스프링 속성으로 노출하는 기능을 활성화한다.
3. 설정에 따라 모든 스프링 빈을 로드한다.

### @SpringBootApplication 어노테이션
@SpringBootApplication은 세 가지 어노테이션에 대한 바로가기다.
- @Configuration : 스프링 애플리케이션 콘텍스트 구성 파일이라는 것을 나타낸다.
- @EnableAutoConfiguration : 스프링 부트의 중요한 기능인 자동 설정을 가능하게 한다. 자동 설정은 별도의 절에서 설명한다.
- @ComponentScan : 이 클래스의 패키지와 모든 서브패키지에서 스프링 빈을 검색할 수 있도록 해준다.

## Hello World 애플리케이션 구동
Hello World 애플리케이션은 여러 가지 방법으로 실행할 수 있다. 자바 애플리케이션으로 실행하는 가장 간단한 옵션으로 실행해보자. IDE에서 애플리케이션 클래스를 마우스 오른쪽 버튼으로 클릭하고 자바 애플리케이션을 실행한다.

간단한 pom.xml파일과 하나의 자바 클래스를 사용하면 앞서 설명한 모든 기능이 포함된 스프링 MVC 애플리케이션을 시작할 수 있다. 스프링 부트에서 가장 중요한 것은 백그라운드에서 일어나는 일을 이해하는 것이다. 시작 로그를 이해하는 것이 먼저다. 메이븐 의존성을 좀 더 자세히 살펴보자.
스프링 부트는 많은 마법을 만든다. 애플리케이션을 설정하고 구동한 후에 디버깅할 때는 문제를 더 깊게 이해하는 것이 좋다.

## 자동 설정
자동 설정을 더 잘 이해할 수 있도록 애플리케이션 클래스를 확장해 몇 줄의 코드를 추가해보자
```java
    ApplicationContext ctx = SpringApplication.run(Application.class, args);
		String[] beanNames = ctx.getBeanDefinitionNames();
		Arrays.sort(beanNames);
		for (String beanName : beanNames) {
			System.out.println(beanName);
		}
```
Application.java가 자바 프로그램으로 구동되면, 빈 목록이 나타난다.

고려해야 할 사항은 다음과 같다.
- 빈들은 어디에 정의돼 있는가?
- 빈들은 어떻게 만들어지는가?

다음은 스프링 자동 설정의 마술이다.
스프링 부트 자동 설정은 스프링 부트 프로젝트에 새로운 의존성을 추가할 때마다 의존성을 기반으로 빈을 자동으로 설정하려고 시도한다.

예를 들어, spring-boot-starter-web에 의존성을 추가하면, 다음 빈이 자동으로 설정된다.
- basicErrorController, handlerExceptionResolver : 기본 예외 처리다. 예외가 발생할 때 기본 에러 페이지를 표시한다.
- beanNameHandlerMapping : 핸들러(컨트롤러)에 대한 경로를 확인하는 데 사용하면 된다.
- characterEncodingFilter : 기본 문자 인코딩 UTF-8을 제공한다.
- dispatcherServlet : 스프링 MVC 애플리케이션의 프론트 컨트롤러다.
- jacksonObjectMapper : 객체를 JSON으로 변환하고, REST 서비스에서는 JSON을 객체로 변환한다.
- messageConverters : 객체를 XML 또는 JSON으로 또는 그 반대로 변환하는 기본 메시지 컨버터다.
- multipartResolver : 웹 애플리케이션의 파일 업로드 지원을 제공한다.
- mvcValidator : HTTP 요청의 검증을 지원한다.
- viewResolver : 논리적 뷰 이름을 물리적 뷰로 해석한다.
- propertySourcesPlaceholderConfigurer : 애플리케이션 구성의 외부화를 지원한다.
- requestContextFilter : 요청에 대한 필터를 기본값으로 지정한다.
- restTemplateBuilder : REST 서비스를 호출하는 데 사용한다.
- tomcatEmbeddedServletContainerFactory : 톰캣은 스프링 부트-기반 웹 애플리케이션을 위한 기본 임베디드 서블릿 컨테이너다.

다음 절에서는 몇 가지 스타터 프로젝트와 이들이 제공하는 자동 설정을 살펴보자.
