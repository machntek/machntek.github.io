---
title: "MSA(Micro Service Architecture)란?(2)"
date: 2019-12-08T15:34:30-04:00
categories:
  - DevOps/Architecture
tags:
  - MSA
---

# Micro Service Architecture

Micro Service Architecture는 각각의 마이크로 서비스들의 기능을 유연하게 결합하고 불가피한 장애, 향후 확장 여부 및 새로운 기능 통합에 대비할 수 있도록 서비스 간 커뮤니케이션 및 개발팀의 구조를 조정하는 것이다.

출처 : 레드햇

MSA로 구성된 시스템은 수많은 마이크로 서비스로 이뤄져있는데, 이러한 시스템을 이용하는 사용자가 마치 하나의 서비스를 이용하는 것처럼 하기 위해서 API Gateway가 필요하다(사용자 입장에서는 Monolithic인지 MSA인지 관심도 없고, 구별할 수도 없어야 한다). API 게이트웨이는 각각의 서비스들을 호출(service mesh)하고 인증 및 권한, 모니터링, logging 등 추가적인 기능을 수행한다. Netflix Zuul을 통해 이러한 API게이트웨이를 쉽게 구성할 수 있다(Spring cloud를 사용하면 된다). API게이트웨이의 기능이 소스단에서 어떤 방식으로 구현되고 사용되는지는 추후에 포스팅 할 예정이다.

![api gateway](https://d1jnx9ba8s6j9r.cloudfront.net/blog/wp-content/uploads/2018/02/Architecture-Of-Microservices-Microservice-Architecture-Edureka.png)
출처 : [apigatewaypic](https://dzone.com/articles/microservice-architecture-learn-build-and-deploy-a)

### MSA의 장점
- 배포(deployment) 관점
  - 서비스 별 개별 배포 가능 (배포 시 전체 서비스의 중단이 없음)
  - 요구사항을 신속하게 반영하여 빠르게 배포할 수 있음
- 확장(scaling) 관점
  - 특정 서비스에 대한 확장성이 용이함
  - 클라우드 사용에 적합한 아키텍쳐
- 장애(failure) 관점
  - 장애가 전체 서비스로 확장될 가능성이 적음
  - 부분적 장애에 대한 격리가 수월함
 
### MSA의 단점
MSA는 Monolithic보다 복잡한 아키텍쳐로, 전체 서비스가 커짐에 따라 그 복잡도가 기하급수적으로 늘어날 수 있습니다.
- 성능 - 서비스 간 호출 시 API를 사용하기 때문에, 통신비용이나 latency가 그만큼 늘어나게 됩니다.
- 테스트/트랜잭션 - 서비스가 분리되어 있기 때문에 테스트와 트랜잭션의 복잡도가 증가하고, 많은 자원을 필요로 합니다.
- 데이터관리 - 데이터가 여러 서비스에 걸쳐 분산되기 때문에 한번에 조회하기 어렵고, 데이터의 정합성 또한 관리하기 어렵습니다.

출처 : [tedigom velog](https://velog.io/@tedigom)

# 기타 등등
MSA아키텍쳐의 전반적인 개념과 설명에 대해 2개의 포스팅을 통해 알아보았다. MSA에 대해 조사해보고 11번가의 MSA전환 프로젝트, 우아한형제들 기술블로그 등을 살펴본 결과 느낀점은 MSA는 사용자에 대한 것보다는 철저히 개발자 대한 것에 관련이 높다는 것이다. 
그렇게 생각한 이유는 MSA는 각 독립된 서비스로 나눠지고 서비스끼리의 의존도가 낮아지면서 기능 수정/추가에 대해 개발자는 해당 서비스에만 집중할 수 있게 되어 더 애자일한 개발이 가능하다고 보기 때문이다.(개발자는 더욱 편하지만 아키텍쳐는 더 높은 역량을 지녀야 할 것이다. 때문에 DevOps라는 개념이 생기고 중요도가 높아졌다)
또한, 각 서비스로 잘게 쪼개져 있으므로, 각 서비스에서 필요한 프레임워크와 기술스택, DB를 사용하여 운영이 가능하다.

그리고 가장 중요한점은 MSA는 단순히 서비스를 기술적으로 쪼개는 문제가 아니라 조직의 구조와 업무 프로세스, DB분할을 위한 도메인의 재정의 등의 복잡한 문제가 있다는 것이다. 블라인드의 IT엔지니어 라운지에서 MSA를 실제로 접하고 개발한 현직 개발자들의 의견을 찾아봤다.

1. MSA의 첫단계는 독립적인 업무 중에 가장 작고 변경이 자주 일어날 수 있는 것을 API 호출로도 충분한 workload 하나씩 꺼내는것. 예를 들어 금융권이면, 환율 혹은 주가 조회와 같은 작은 기능부터 꺼내서 먼저 구성한다. 그렇게 미션 크리티컬한 기능에 큰 영향이 없으면서 잦은 배포가 일어나는 단위가 있으면 우선 빼내면 됨.

2. MSA정의는 DB의 분리라고 생각합니다.

3. DB 안나누면 SPOF(단일 장애 지점)이 디비가 될 수 있어요.

4. DB는 조금 특수한 영역이라서 도메인이 다르다든지 해서 확실히 나눠지면 나누고 나누기 힘들면 아무리 MSA라도 억지로 나누지 마라. 데이터를 안전하게 동기화하는 것부터 많은 시련이 뒤따른다.

5. 원칙상으로는 db를 나누어서 트래픽과 장애를 격리해야 하는 것으로 알고 있습니다.

등등 MSA로 검색하면 DB에 대한 내용이 주를 이루었다. 이에 대해 MSA는 업무 도메인을 재정의하면서 DB를 쪼개고, 작은 유닛단위로 개발조직이 애자일하게 움직이는 목적에서 나온 아키텍쳐라는 생각이 들었다.
각 서비스들이 나눠져있고 디비마져 분리되면서 하나의 서비스가 장애가 난다고 해서 전체 시스템에 영향을 주지 않기 때문이다.
그리고 매우 복잡하게 얽히고 섥힌 도메인에서 무리하게 MSA로의 전환은 안된다고 본다. MSA는 시스템과 개발조직의 필요에 의해서 나온 결과물일 뿐이지, 단순히 트렌드라고 해서 해당 조직의 업무도메인과 맞지 않는 아키텍쳐를 사용할 이유는 없다고 본다.

이후 포스팅에서는 MSA로 토이프로젝트를 진행할 예정이다. 프로젝트를 진행하면서 느낀 장단점 및 MSA의 필요성에 대해 본 포스팅을 업데이트 하겠다.

